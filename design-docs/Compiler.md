## Android Codegen overview

A high level overview of the current Android codegen.

```
           +----------------+
           |                |
           | .graphql files |
           |                |
           +----------------+
                   |
                   | +--------+ Grammar.g4
                   + v
                 Antlr
           Syntax validation +------+
                   +                |
                   v                v
          +-----------------+  +----------+    DocumentContext is auto+generated by antlr and represents the parse tree
          |                 |  |          |    Syntax issues are output to the user if any.
          | DocumentContext |  |  Issues  |
          |                 |  |          |
          +-----------------+  +----------+
                   |
                   +
              GQL builder
                   +
                   v
            +-------------+                    GQLDocument is a 1:1 mapping of the antlr parse tree
            |             |                    It is a GraphQL AST
            | GQLDocument |                    Since the syntax is correct at this point, it can use Kotlin nullsafe
            |             |                    properties and sealed classes to better represent the data.
            +-------------+                    It also support creating/inserting new elements and writing the document
                   |                           to a file
                   | +--------+ Schema
                   + v
          GraphQL Validation +----+
                   +              |
                   v              v
            +-------------+  +----------+      At this stage, the GQLDocuments are the same as before but are validated so a
            |             |  |          |      lot more assumptions can be done later in the compiler.
            | GQLDocument |  |  Issues  |      GraphQL Issues are output to the user if any
            |             |  |          |
            +-------------+  +----------+
                   |
                   |
                   | +--------+ Schema
                   + v
        interpret @include/@skip
          interpret @deprecated
        infer fragments variables
Compute all possible shapes and interfaces
                   +
                   v
            +--------------+                   Unified IR is easier to work with than GQLDocument as it resolves types against
            |              |                   the schema. It also interprets directive and can represent things that cannot
            | Unified IR   |                   be represented in pure GraphQL like boolean combinations of fields and fragments
            |              |                   arguments
            +--------------+
                   |
                   | +--------+ operationIds
                   | |
                   | |
                   + v
    Compute possible implementations
         Compute selection keys
     (Merge fields across fragments)
                   +
                   v
            +--------------+                    Codegen IR converts fields to actual properties and nested classes
            |              |                    It maps the generated models but isn't bound to Kotlin Poet
            |  Codegen IR  |
            |              |
            +--------------+
                   |
                   | +--------+ codegen options the codegen supports several options such as:
                   | v                          * generateAsInternal
                   | +--------+ package names   * generateFilterNotNull
                   + v                          * enumAsSealedClass
        Escape Kotlin keywords                  * generateFragmentImplementations
       Actual KotlinPoet codegen                * etc..
                   +
                   v
            +--------------+
            |              |
            |  .kt files   |
            |              |
            +--------------+
```